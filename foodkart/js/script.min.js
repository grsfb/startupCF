var app = angular.module('co', ['ngRoute']);
app.config(['$routeProvider',
    function ($routeProvider, $locationProvider) {
        $routeProvider.
            when('/about-us', {
                templateUrl: 'foodkart/pages/about-us/about-us.html'
            }).
            when('/how-it-works', {
                templateUrl: 'foodkart/pages/how-we-work/how-it-works.html'
            }).when('/contact-us', {
                templateUrl: 'foodkart/pages/contact-us/contact-us.html'
            }).
            otherwise({
                templateUrl: 'foodkart/pages/home/items.html',
                controller: 'RC'
            });
    }]).run(function ($rootScope, $location) {
    $rootScope.$on("$routeChangeStart", function (event, next, current) {
        $rootScope.homepage = false;
    })
});

var routeLoadingIndicator = function($rootScope){
    return {
        restrict:'E',
        template:"<h1 ng-if='isRouteLoading'>Loading...</h1>",
        link:function(scope, elem, attrs){
            scope.isRouteLoading = false;

            $rootScope.$on('$routeChangeStart', function(){
                scope.isRouteLoading = true;
            });

            $rootScope.$on('$routeChangeSuccess', function(){
                scope.isRouteLoading = false;
            });
        }
    };
};

app.controller('RC', function ($rootScope, $scope, $http) {
    $rootScope.homepage = true;
    $scope.chef={};
    $scope.displayMsg="";
    $scope.formSubmitted=false;
    $scope.submit = function () {
        $scope.formSubmitted=true;
        $scope.displayMsg="Your request successfully submitted."
        var req = {
            method: 'POST',
            url: 'http://chefonia.com/endpoint/db',
            headers: {'Content-Type': 'application/json;charset=UTF-8',
                'Authorization':'Basic '+"c2VjcmV0YWRtaW46cGFzc3dvcmRAY2hlZm9uaWFmb29ka2FydA=="
            },
            data: $scope.chef
        };
        try{
            $http(req).then(function (response) {
                $scope.chef={};
                if (response.status == 201) {
                    $scope.displayMsg="Successfully registered. We will call you soon."
                }else if(response.status==202){
                    $scope.displayMsg="You are already registered with us."
                }else{
                    $scope.displayMsg="Oops something went wrong, please try later.";
                }
            });
        }catch (err){
            $scope.displayMsg="Oops something went wrong, please try later.";
        }

    }

    $scope.reset= function () {
       $scope.formSubmitted=false;
        $scope.displayMsg="";
        $scope.chef={};
    }
    animateHeader();
});
var animateHeader = function () {
    $('.heading').textillate({
        minDisplayTime: 5000,
        loop: true,
        autoStart: true,
        in: {
            effect: 'fadeInUp',
            delayScale: 1.5,
            delay: 50,
            sync: false,
            sequence: true
        },
        out: {
            effect: 'fadeInUp',
            delayScale: 1.5,
            delay: 50,
            sync: false,
            sequence: true
        }
    });
}

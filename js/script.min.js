var app = angular.module('Chefonia', ["ngRoute", "ngCookies"]);

app.config(['$routeProvider',
    function ($routeProvider, $locationProvider) {

        $routeProvider.
            when('/about-us', {
                templateUrl: 'foodkart/pages/about-us/about-us.html'
            }).
            when('/how-it-works', {
                templateUrl: 'foodkart/pages/how-we-work/how-it-works.html'
            }).when('/contact-us', {
                templateUrl: 'foodkart/pages/contact-us/contact-us.html'
            }).when('/register', {
                templateUrl: 'pages/register/register.html',
                controller: 'RegisterController',
                controllerAs: 'vm'
            }).when('/login', {
                templateUrl: 'pages/login/login.html',
                controller: 'LoginController',
                controllerAs: 'vm'
            }).when('/address', {
                templateUrl: 'pages/address/address.html'
            }).when('/payment', {
                templateUrl: 'pages/payment/payment.html'
            }).when('/cart', {
                templateUrl: 'pages/cart/cartdetails.html',
                controller: 'CartController',
                controllerAs: 'vm'
            }).when('/checkout', {
                templateUrl: 'pages/checkout/checkout.html',
                controller: 'CheckoutController',
                controllerAs: 'vm'
            }).when('/item', {
                templateUrl: 'pages/items/items.html',
                controller: 'ItemController',
                controllerAs: 'vm'
            }).when('/success', {
                templateUrl: 'pages/success-order/success.html',
            }).when('/login_mble', {
                templateUrl: 'pages/login/login_mble.html',
                controller: 'ItemController',
                controllerAs: 'vm'
            }).otherwise({
                templateUrl: 'pages/front/front.html',
                controller: 'RC'
            });
    }]).run(function ($rootScope, $location) {
    $rootScope.$on("$routeChangeStart", function (event, next, current) {
        $rootScope.homepage = false;
    })
});
app.controller('NavbarController', function ($cookieStore, $rootScope, AuthenticationService) {
        $rootScope.isLoggedIn = false;
        $rootScope.currentUser = $cookieStore.get('currentUser');
        $rootScope.cartItemCount = 0;
        $rootScope.wishListCount = 0;
        if ($rootScope.currentUser) {
            $rootScope.isLoggedIn = true;
            $rootScope.loginName = $rootScope.currentUser.userName;
        }
        if ($cookieStore.get('wishList')) {
            $rootScope.wishListCount = $cookieStore.get("wishList").length;
        }
        if ($cookieStore.get("cart")) {
            $rootScope.cartItemCount = $cookieStore.get("cart").length;
        }
        $rootScope.login = function () {

            $("#myModal").modal();
        }
        $rootScope.logout = function () {

            AuthenticationService.ClearCredentials();
        }

    }
);

app.controller('RC', function ($rootScope, $scope, $http) {
    $rootScope.homepage = true;
    $scope.chef = {};
    $scope.displayMsg = "";
    $scope.formSubmitted = false;
    $scope.submit = function () {
        $scope.formSubmitted = true;
        $scope.displayMsg = "Your request successfully submitted."
        var req = {
            method: 'POST',
            url: 'http://chefonia.com/endpoint/db',
            headers: {
                'Content-Type': 'application/json;charset=UTF-8',
                'Authorization': 'Basic ' + "c2VjcmV0YWRtaW46cGFzc3dvcmRAY2hlZm9uaWFmb29ka2FydA=="
            },
            data: $scope.chef
        };
        try {
            $http(req).then(function (response) {
                $scope.chef = {};
                if (response.status == 201) {
                    $scope.displayMsg = "Successfully registered. We will call you soon."
                } else if (response.status == 202) {
                    $scope.displayMsg = "You are already registered with us."
                } else {
                    $scope.displayMsg = "Oops something went wrong, please try later.";
                }
            });
        } catch (err) {
            $scope.displayMsg = "Oops something went wrong, please try later.";
        }


    }

    //handling items page

    /*********************/

    /*$scope.items={};*/
    $scope.city = 'Pune';
    $http.get('/client/data/items.json').success(function (data) {
        $scope.products = data;
    });

    $scope.reset = function () {
        $scope.formSubmitted = false;
        $scope.displayMsg = "";
        $scope.chef = {};
    }
    $scope.cityChange = function (city) {
        $scope.cityList = ['Pune', 'Nasik', 'Mumbai'];

        $scope.city = city;
    };
    $scope.foodChange = function (snack) {
        $scope.snack = snack;
    };

    $scope.reset = function () {
        $scope.formSubmitted = false;
        $scope.displayMsg = "";
        $scope.chef = {};
    }
    animateHeader();
});
app.controller("citylistctrl", function ($scope) {
    if ($scope.city == 'Pune') {
        $scope.cityList = ['Nagpur', 'Mumbai'];
    }
    $scope.getLocation = function () {
        $scope.cityList = ['Pune', 'Nasik', 'Mumbai'];
    }

});

app.controller("foodlistctrl", function ($scope) {
    $scope.foodList = ['Achar', 'Papad', 'Snacks'];
    $scope.popularFoodList = ['Ice Cream', 'Biryani'];
    $scope.newFoodList = ['Khakhra', 'Chakli'];

});
function change() {

    $scope.cityList = ['Pune', 'Nasik', 'Mumbai'];
}
app.controller('popularListCtrl', function ($scope, $http) {
    $http.get('/client/data/popularItems.json').success(function (data) {
        $scope.slides = data;
    });
    $("#popularowlNext").click(function () {
        $("#owl-demo").trigger('owl.next');
    })
    $("popularowlPrev").click(function () {
        $("#owl-demo").trigger('owl.prev');
    })
}).directive("owlCarousel", function () {
    return {
        restrict: 'E',
        transclude: false,
        link: function (scope) {
            scope.initCarousel = function (element) {
                // provide any default options you want
                var defaultOptions = {
                    items: 4, //10 items above 1000px browser width
                    itemsDesktop: [1000, 5], //5 items between 1000px and 901px
                    itemsDesktopSmall: [900, 3], // betweem 900px and 601px
                    itemsTablet: [600, 2], //2 items between 600 and 0
                    itemsMobile: false, // itemsMobile disabled - inherit from itemsTablet option
                    autoPlay: true,
                    slideSpeed: 200,
                    navigationText: false,
                    pagination: false,
                    stopOnHover: true
                    // Custom Navigation Events
                };
                var customOptions = scope.$eval($(element).attr('data-options'));
                // combine the two options objects
                for (var key in customOptions) {
                    defaultOptions[key] = customOptions[key];
                }
                // init carousel
                $(element).owlCarousel(defaultOptions);
            };
        }
    };
})
    .directive('owlCarouselItem', [function () {
        return {
            restrict: 'A',
            transclude: false,
            link: function (scope, element) {
                // wait for the last item in the ng-repeat then call init
                if (scope.$last) {
                    scope.initCarousel(element.parent());
                }
            }
        };
    }]);
app.controller('newListCtrl', function ($scope, $http) {
    $http.get('/client/data/popularItems.json').success(function (data) {
        $scope.newSlides = data;
    });
    $("#newowlNext").click(function () {
        $("#owl-demo-new").trigger('owl.next');
    });
    $("#newowlPrev").click(function () {
        $("#owl-demo-new").trigger('owl.prev');
    });
});
//app.controller("popularListCtrl", function ($scope,$http) {
//////    $scope.slides = ['http://www.apkachotu.com/media/catalog/product/cache/2/small_image/300x300/9df78eab33525d08d6e5fb8d27136e95/g/a/garlic_methi_khakhra_gehu_ke_200gm_rs.30.jpg'
//////        , 'http://www.misstamchiak.com/wp-content/uploads/2014/02/IMG_80951-300x300.jpg'
//////        , 'http://farsankart.com/wp-content/uploads/2013/04/bb-300x300.jpg'
//////        , 'http://hostedmedia.reimanpub.com/TOH/Images/Photos/37/300x300/exps116443_HCA2081250B01_14_4b_WEB.jpg'
//////        , 'http://hostedmedia.reimanpub.com/TOH/Images/Photos/37/300x300/exps35314_CFT961319D56.jpg'
//////        , 'http://www.giftstoindia24x7.com/ASP_Img/GTI10280.jpg'
//////    ,'http://pimg.tradeindia.com/00797751/b/1/Chakri.jpg'
//////    ,'http://farsankart.com/wp-content/uploads/2012/11/jain-bhakarwadi-300x300.png'
//////        ,'http://pikachakula.com/wp-content/uploads/2011/09/Besan-Ladoo.jpg'
//////        ,'http://www.thamilmax.com/recipes/templates/images/recipes/236-1.jpg'
//////        ,'http://2.bp.blogspot.com/-Xovm2gtAunU/Tpw61x8giKI/AAAAAAAAD3w/0FDme9yxYwY/s400/boondi-ka-laddu.jpg'
//////        ,'http://waverunnersfastpitch.net/gujarati-food-khandvi-30.jpg'
//////
//////];
////$scope.slides=
//    $http.get('/client/data/popularItems.json').success(function(data) {
//        $scope.slides = data;
//    });
//    $("#owl-demo").owlCarousel({
//        items : 4, //10 items above 1000px browser width
//        itemsDesktop : [1000,5], //5 items between 1000px and 901px
//        itemsDesktopSmall : [900,3], // betweem 900px and 601px
//        itemsTablet: [600,2], //2 items between 600 and 0
//        itemsMobile : false // itemsMobile disabled - inherit from itemsTablet option
//    });
//
//    // Custom Navigation Events
//    $(".next").click(function(){
//        $("#owl-demo").trigger('owl.next');
//    })
//    $(".prev").click(function(){
//        $("#owl-demo").trigger('owl.prev');
//    })
//    $(".play").click(function(){
//        $("#owl-demo").trigger('owl.play',1000); //owl.play event accept autoPlay speed as second parameter
//    })
//    $(".stop").click(function(){
//        $("#owl-demo").trigger('owl.stop');
//    })
//});
var animateHeader = function () {
    $('.heading').textillate({
        minDisplayTime: 5000,
        loop: true,
        autoStart: true,
        in: {
            effect: 'fadeInUp',
            delayScale: 1.5,
            delay: 50,
            sync: false,
            sequence: true
        },
        out: {
            effect: 'fadeInUp',
            delayScale: 1.5,
            delay: 50,
            sync: false,
            sequence: true
        }
    });
}